var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__awaiter=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(a,o){function i(t){try{s(r.next(t))}catch(e){o(e)}}function c(t){try{s(r["throw"](t))}catch(e){o(e)}}function s(t){t.done?a(t.value):new n(function(e){e(t.value)}).then(i,c)}s((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(a)throw new TypeError("Generator is already executing.");for(;s;)try{if(a=1,o&&(i=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(i=i.call(o,n[1])).done)return i;switch(o=0,i&&(n=[0,i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(i=s.trys,!(i=i.length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(r){n=[6,r],o=0}finally{a=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,o,i,c,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return c={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c},cacs;!function(t){var e=function(){function t(){}return t.init=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.inited=!0,[2]})})},t.getURL=function(t){var e="",n=t.split("/"),r=n[3],a=n[4];if(r&&a){t=n[0]+"//"+n[2]+"/"+r+"/"+a+"/";var o=n[n.length-1].split("_");if(o.length>1){for(var i=0;i<o.length-1;i++)t=t+"_"+o[i];var c=o[o.length-1].split(".");c.length>1&&(t=t+"."+c[c.length-1],e=t+"_AND_"+o[o.length-1])}}return e},t.match=function(t,e,r){return __awaiter(this,void 0,void 0,function(){var o,i,c,s,s;return __generator(this,function(u){switch(u.label){case 0:return o=new a(t),i=this.getURL(o.url),[4,n.match(i)];case 1:return(c=u.sent())?(console.log("读取缓存",i),[4,this.parserData(c,e)]):[3,3];case 2:return s=u.sent(),r(s),[3,5];case 3:return[4,this.fetch(o,i,e)];case 4:s=u.sent(),r(s),u.label=5;case 5:return[2]}})})},t.fetch=function(t,e,a){return __awaiter(this,void 0,void 0,function(){var o,i,c,s,u=this;return __generator(this,function(f){switch(f.label){case 0:return[4,r(t)];case 1:return o=f.sent(),i=o.clone(),[4,n.open(this.cacheName)];case 2:return c=f.sent(),e&&this.isPutCache(e,o)&&this.canPut?[4,c.keys()]:[3,4];case 3:s=f.sent(),s=s.filter(function(t){var n=t.url.split("_AND_"),r=e.split("_AND_");return n[0]==r[0]&&n[1]!=r[1]}),s[0]&&c["delete"](s[0]),s[0]&&console.log("删除匹配项",s[0].url),c.put(e,i).then(function(t){return console.log("存储",e)})["catch"](function(t){u.canPut=!1,console.log("存储失败",t)}),f.label=4;case 4:return[2,this.parserData(o,a)]}})})},t.isPutCache=function(t,e){return e&&200===e.status&&"basic"===e.type?t.indexOf("default.res.json")>-1?!1:t.indexOf("cacheFile.json")>-1?!1:t.indexOf("index.html")>-1?!1:t.indexOf("manifest.json")>-1?!1:t.indexOf("version.json")>-1?!1:!0:!1},t.parserData=function(t,e){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(r){switch(n=null,e){case"sound":n=t.arrayBuffer();break;case"image":n=t.blob();break;case"js":n=t.text();break;case"json":n=t.json()}return[2,n]})})},t.storageEstimateWrapper=function(){return"storage"in navigator&&"estimate"in navigator.storage?navigator.storage.estimate():"webkitTemporaryStorage"in navigator&&"queryUsageAndQuota"in navigator.webkitTemporaryStorage?new Promise(function(t,e){navigator.webkitTemporaryStorage.queryUsageAndQuota(function(e,n){t({usage:e,quota:n})},e)}):Promise.resolve({usage:0,quota:0})},t.cacheName="v2.0.2",t.inited=!1,t.canPut=!0,t}();t.CacheStorageManager=e,__reflect(e.prototype,"cacs.CacheStorageManager");var n=window.caches,r=window.fetch,a=window.Request,o=window.Response;n&&n.open&&n.match&&n["delete"]&&n.keys&&r&&a&&o&&e.init()}(cacs||(cacs={}));var cacs;!function(t){var e=function(){function e(){}return e.init=function(){this.winURL=window.URL||window.webkitURL,this.request()},e.request=function(){var e=this;egret.ImageLoader.prototype.load=function(n){var r=this;!e.winURL||0==n.indexOf("wxLocalResource:")||0==n.indexOf("data:")||0==n.indexOf("http:")&&n.split("/")[2]!=location.host||0==n.indexOf("https:")&&n.split("/")[2]!=location.host?this.loadImage(n):t.CacheStorageManager.match(n,"image",function(t){r.request=void 0,r.loadImage(e.winURL.createObjectURL(t))})}},e}();t.ImageParser=e,__reflect(e.prototype,"cacs.ImageParser")}(cacs||(cacs={}));var cacs;!function(t){var e=function(){function e(){}return e.init=function(){this.request()},e.request=function(){var t=this,e=window.RES,n={onLoadStart:function(e,n){return t.getJsonData(e,n)},onRemoveStart:function(t,e){}},r={onLoadStart:function(n,r){return t.getJsonData(n,r).then(function(a){var o=t.getRelativePath(r.url,a.file),i=n.resourceConfig.getResource(e.nameSelector(o));return i||(i={name:o,url:o,type:"image",root:r.root}),n.load(i).then(function(t){var e=new egret.BitmapFont(t,a);return e.$resourceInfo=i,n.save(i,t),e},function(t){throw n.remove(i),t})})},onRemoveStart:function(t,e){var n=t.get(e),r=n.$resourceInfo;t.unload(r)}};e.processor.map("json",n),e.processor.map("font",r)},e.getJsonData=function(e,n){return new Promise(function(e,r){var a=n.root+n.url;t.CacheStorageManager.match(a,"json",function(t){e(t)})})},e.getRelativePath=function(t,e){if(-1!=e.indexOf("://"))return e;t=t.split("\\").join("/");var n=t.match(/#.*|\?.*/),r="";n&&(r=n[0]);var a=t.lastIndexOf("/");return t=-1!=a?t.substring(0,a+1)+e:e,t+r},e}();t.JsonParser=e,__reflect(e.prototype,"cacs.JsonParser")}(cacs||(cacs={}));var cacs;!function(t){var e=function(){function e(){}return e.init=function(){this.request()},e.request=function(){var e=window.egret,n=e.web;e.web.WebAudioSound.prototype.load=function(r){function a(){i.loaded=!0,i.dispatchEventWith(e.Event.COMPLETE)}function o(){i.dispatchEventWith(e.IOErrorEvent.IO_ERROR)}var i=this;this.url=r,r||e.$error(3002),t.CacheStorageManager.match(r,"sound",function(t){n.WebAudioDecode.decodeArr.push({buffer:t,success:a,fail:o,self:i,url:i.url}),n.WebAudioDecode.decodeAudios()})}},e}();t.SoundParser=e,__reflect(e.prototype,"cacs.SoundParser")}(cacs||(cacs={}));